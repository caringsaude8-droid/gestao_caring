<div class="tea-calendario-container">
  <!-- Header -->
  <div class="calendario-header">
    <div class="header-info">
      <h1 class="calendario-title">Calendário TEA</h1>
      <p class="calendario-subtitle">Agendamento e acompanhamento de sessões</p>
    </div>
    <button class="new-appointment-btn" (click)="openNewAppointment()">
      <i class="icon-plus"></i>
      Nova Sessão
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-section">
    <div class="stats-grid">
      <div class="stat-card stat-scheduled">
        <div class="stat-icon">
          <i class="icon-calendar"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-title">Agendadas</h3>
          <p class="stat-value">{{getMonthStats().scheduled}}</p>
        </div>
      </div>
      
      <div class="stat-card stat-completed">
        <div class="stat-icon">
          <i class="icon-check"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-title">Concluídas</h3>
          <p class="stat-value">{{getMonthStats().completed}}</p>
        </div>
      </div>
      
      <div class="stat-card stat-cancelled">
        <div class="stat-icon">
          <i class="icon-x"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-title">Canceladas</h3>
          <p class="stat-value">{{getMonthStats().cancelled}}</p>
        </div>
      </div>
      
      <div class="stat-card stat-no-show">
        <div class="stat-icon">
          <i class="icon-alert"></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-title">Faltas</h3>
          <p class="stat-value">{{getMonthStats().noShow}}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Layout com Sidebar (igual aos outros) -->
  <div class="content-with-sidebar">
    <aside class="calendar-sidebar">
      <div class="calendar-header">
        <button class="cal-nav" (click)="previousMonth()">‹</button>
        <div class="cal-title">{{getCurrentMonthYear()}}</div>
        <button class="cal-nav" (click)="nextMonth()">›</button>
      </div>

      <div class="calendar-weekdays">
        <span *ngFor="let w of weekDays">{{w}}</span>
      </div>

      <div class="calendar-grid">
        <div *ngFor="let day of calendarDays" 
             class="calendar-day cal-cell"
             [class.other-month]="!day.isCurrentMonth"
             [class.out-month]="!day.isCurrentMonth"
             [class.today]="day.isToday"
             [class.selected]="day.date.toISOString().split('T')[0] === selectedDayISO"
             (click)="selectDay(day)">
          <div class="day-number">{{day.date.getDate()}}</div>
          <span class="availability-dot" *ngIf="day.appointments.length > 0"></span>
        </div>
      </div>
    </aside>

    <div class="main-column">
      <div class="full-view-section">
        <div class="sessions-header">
          <h3 class="section-title">Visualização Completa ({{selectedDayISO}})</h3>
          <div class="header-actions">
            <label class="status-filter-label">Filtrar por Status</label>
            <select class="status-filter-select" [(ngModel)]="statusFilter">
              <option>Todos</option>
              <option>Agendado</option>
              <option>Confirmado</option>
              <option>Cancelado</option>
            </select>
          </div>
        </div>

        <table class="agenda-table">
          <colgroup>
            <col style="width:4%">
            <col style="width:10%">
            <col style="width:32%">
            <col style="width:20%">
            <col style="width:8%">
            <col style="width:12%">
            <col style="width:14%">
          </colgroup>
          <thead>
            <tr>
              <th></th>
              <th>Hora</th>
              <th>Nome</th>
              <th>Procedimento</th>
              <th>Sala</th>
              <th>Por</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of filteredDaySlots">
              <td><input type="checkbox" /></td>
              <td>{{ s.hora }}</td>
              <td [title]="s.paciente || 'Horário Livre'">{{ s.paciente || 'Horário Livre' }}</td>
              <td>{{ getEspecialidadeNome(s.especialidadeId) }}</td>
              <td>–</td>
              <td>{{ getProfissionalNome(s.profissionalId) }}</td>
              <td>
                <span class="status-badge" [class]="'badge-' + (s.status === 'cancelado' ? 'cancelled' : s.status === 'confirmado' ? 'completed' : 'scheduled')">
                  {{ getSlotStatusLabel(s.status) | uppercase }}
                </span>
              </td>
            </tr>
            <tr *ngIf="filteredDaySlots.length === 0">
              <td colspan="7">Nenhum agendamento para o dia selecionado.</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
  
  <!-- Tabela semanal posicionada ABAIXO do layout (fora da coluna) -->
  <div class="weekly-table-wrapper">
    <table class="weekly-table">
      <thead class="weekly-header">
        <tr>
          <th class="time-col">Horário</th>
          <th *ngFor="let day of weeklyDays" [class.current-day]="isToday(day.date)">{{ day.label }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let time of weeklyTimeSlots">
          <td class="time-col">{{ time }}</td>
          <td *ngFor="let day of weeklyDays" [class.has-session]="getWeeklyCellContent(day.date, time)" [class.current-day]="isToday(day.date)">
            <ng-container *ngIf="getWeeklyCellContent(day.date, time) as cell">
              <div class="session-card">
                <div class="session-title">{{ cell.patient }} - {{ cell.therapy }}</div>
              </div>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
