<div class="tea-page-container">
  <div class="calendario-header">
    <div class="header-info">
      <h1 class="calendario-title">Calendário por Profissionais</h1>
      <p class="calendario-subtitle">Visão semanal de sessões do profissional</p>
    </div>
  </div>

  <!-- Controles superiores removidos conforme solicitação -->

  <section class="controls-section controls-card">

    <div class="filters-grid">
      <div class="search-group">
        <label class="filter-label">Profissional</label>
        <input class="search-input" type="text" placeholder="Buscar profissional" [(ngModel)]="professionalSearch" />
      </div>
      <div class="filter-group">
        <label class="filter-label">Seleção</label>
        <select [(ngModel)]="selectedProfessional" (ngModelChange)="onProfessionalChange($event)" class="filter-select">
          <option value="">Selecione...</option>
          <option *ngFor="let p of filteredProfessionals" [value]="p">{{ p }}</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Sessão</label>
        <input class="search-input" type="text" placeholder="Paciente ou terapia" [(ngModel)]="sessionSearch" />
      </div>
      <div class="actions-group">
        <button class="action-btn action-primary" [disabled]="!selectedProfessional" (click)="listar()">Listar</button>
        <button class="action-btn action-secondary" (click)="clearProfessionalFilters()">Limpar</button>
      </div>
    </div>
  </section>

  <!-- Layout com sidebar (mini calendário) e coluna principal -->
  <div class="content-with-sidebar">
    <aside class="calendar-sidebar">
      <div class="calendar-header">
        <button class="cal-nav" (click)="previousMonth()">‹</button>
        <div class="cal-title">{{ getCurrentMonthYear() }}</div>
        <button class="cal-nav" (click)="nextMonth()">›</button>
      </div>
      <div class="calendar-weekdays">
        <span *ngFor="let w of ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb']">{{w}}</span>
      </div>
      <div class="calendar-grid">
        <div *ngFor="let day of calendarDays"
             class="calendar-day cal-cell"
             [class.out-month]="!day.isCurrentMonth"
             [class.today]="day.isToday"
             [class.selected]="day.iso === selectedDate"
             (click)="selectSidebarDay(day)">
          <div class="day-number">{{ day.date.getDate() }}</div>
          <span class="availability-dot" *ngIf="day.hasAppointments"></span>
        </div>
      </div>
    </aside>

    <div class="main-column">
      <!-- Estatísticas no topo (igual ao mensal) -->
      <div class="stats-section">
        <div class="stats-grid">
          <div class="stat-card stat-scheduled">
            <div class="stat-icon"><i class="icon-calendar"></i></div>
            <div class="stat-content">
              <h3 class="stat-title">Agendadas</h3>
              <p class="stat-value">{{getWeekStats().scheduled}}</p>
            </div>
          </div>
          <div class="stat-card stat-completed">
            <div class="stat-icon"><i class="icon-check"></i></div>
            <div class="stat-content">
              <h3 class="stat-title">Concluídas</h3>
              <p class="stat-value">{{getWeekStats().completed}}</p>
            </div>
          </div>
          <div class="stat-card stat-cancelled">
            <div class="stat-icon"><i class="icon-x"></i></div>
            <div class="stat-content">
              <h3 class="stat-title">Canceladas</h3>
              <p class="stat-value">{{getWeekStats().cancelled}}</p>
            </div>
          </div>
          <div class="stat-card stat-no-show">
            <div class="stat-icon"><i class="icon-alert"></i></div>
            <div class="stat-content">
              <h3 class="stat-title">Faltas</h3>
              <p class="stat-value">{{getWeekStats().noShow}}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Visualização Completa (dia selecionado) igual ao mensal -->
      <div class="full-view-section">
        <div class="sessions-header">
          <h3 class="section-title">Visualização Completa ({{selectedDate}})</h3>
          <div class="header-actions">
            <label class="status-filter-label">Filtrar por Status</label>
            <select class="status-filter-select">
              <option>Todos</option>
              <option>Agendado</option>
              <option>Confirmado</option>
              <option>Cancelado</option>
            </select>
          </div>
        </div>

        <table class="agenda-table">
          <colgroup>
            <col style="width:4%">
            <col style="width:10%">
            <col style="width:32%">
            <col style="width:20%">
            <col style="width:8%">
            <col style="width:12%">
            <col style="width:14%">
          </colgroup>
          <thead>
            <tr>
              <th></th>
              <th>Hora</th>
              <th>Nome</th>
              <th>Procedimento</th>
              <th>Sala</th>
              <th>Por</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of filteredDaySlots">
              <td><input type="checkbox" /></td>
              <td>{{ s.hora }}</td>
              <td>{{ s.paciente }}</td>
              <td>{{ s.especialidade }}</td>
              <td>–</td>
              <td>{{ s.profissional }}</td>
              <td>
                <span class="status-badge" [class]="getMonthlyBadgeClass(s.status)">{{ getSlotStatusLabel(s.status) | uppercase }}</span>
              </td>
            </tr>
            <tr *ngIf="filteredDaySlots.length === 0">
              <td colspan="7">Nenhum agendamento para o dia selecionado.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="patient-label" *ngIf="selectedProfessional">Profissional: {{ selectedProfessional }}</p>

    </div> <!-- /.main-column -->
  </div> <!-- /.content-with-sidebar -->
  
  <!-- Tabela semanal ABAIXO do layout -->
  <div class="weekly-table-wrapper">
    <table class="weekly-table">
      <thead class="weekly-header">
        <tr>
          <th class="time-col">Horário</th>
          <th *ngFor="let day of weekDays" [class.current-day]="isToday(day.date)">{{ day.label }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let time of timeSlots">
          <td class="time-col">{{ time }}</td>
          <td *ngFor="let day of weekDays" [class.has-session]="getCellContent(day.date, time)" [class.current-day]="isToday(day.date)">
            <ng-container *ngIf="getCellContent(day.date, time) as cell">
              <div class="session-card">
                <div class="session-title">{{ cell.patient }} - {{ cell.therapy }}</div>
              </div>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>