<div class="modal-overlay" *ngIf="show" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- DEBUG: Mostra permissoes -->
    <div class="modal-header">
      <h2 class="modal-title">{{ modalTitle }}</h2>
      <button class="modal-close-btn" (click)="onClose()">
        <i class="icon-x"></i>
      </button>
    </div>

    <form class="modal-body" (ngSubmit)="onSubmit()" #userForm="ngForm">
      <!-- Informações Básicas -->
      <div class="form-section">
        <h3 class="section-title">Informações Básicas</h3>
        
        <div class="form-row">
          <div class="form-group" *ngIf="mode === 'create'">
            <label for="cpf" class="form-label">CPF *</label>
            <input
              type="text"
              id="cpf"
              name="cpf"
              [(ngModel)]="formData.cpf"
              class="form-input"
              placeholder="000.000.000-00"
              required
              maxlength="14"
              #cpfInput="ngModel">
            <div class="form-error" *ngIf="cpfInput.invalid && cpfInput.touched">
              CPF é obrigatório
            </div>
          </div>

          <div class="form-group">
            <label for="nome" class="form-label">Nome Completo *</label>
            <input
              type="text"
              id="nome"
              name="nome"
              [(ngModel)]="formData.nome"
              class="form-input"
              placeholder="Digite o nome completo"
              required
              #nomeInput="ngModel">
            <div class="form-error" *ngIf="nomeInput.invalid && nomeInput.touched">
              Nome é obrigatório
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email" class="form-label">Email *</label>
            <input
              type="email"
              id="email"
              name="email"
              [(ngModel)]="formData.email"
              class="form-input"
              placeholder="exemplo@email.com"
              required
              email
              #emailInput="ngModel">
            <div class="form-error" *ngIf="emailInput.invalid && emailInput.touched">
              <span *ngIf="emailInput.errors?.['required']">Email é obrigatório</span>
              <span *ngIf="emailInput.errors?.['email']">Email deve ter um formato válido</span>
            </div>
          </div>

          <div class="form-group">
            <label for="telefone" class="form-label">Telefone *</label>
            <input
              type="tel"
              id="telefone"
              name="telefone"
              [(ngModel)]="formData.telefone"
              class="form-input"
              placeholder="(11) 99999-9999"
              required
              #telefoneInput="ngModel">
            <div class="form-error" *ngIf="telefoneInput.invalid && telefoneInput.touched">
              Telefone é obrigatório
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="senha" class="form-label">Senha *</label>
            <input
              type="password"
              id="senha"
              name="senha"
              [(ngModel)]="formData.senha"
              class="form-input"
              placeholder="Digite a senha"
              required
              minlength="6"
              #senhaInput="ngModel">
            <div class="form-error" *ngIf="senhaInput.invalid && senhaInput.touched">
              Senha é obrigatória (mínimo 6 caracteres)
            </div>
          </div>
        </div>
      </div>

      <!-- Perfil e Status -->
      <div class="form-section">
        <h3 class="section-title">Perfil e Permissões</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="perfil" class="form-label">Perfil *</label>
            <select
              id="perfil"
              name="perfil"
              [(ngModel)]="formData.perfil"
              class="form-select"
              required>
              <option *ngFor="let option of perfilOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="status" class="form-label">Status *</label>
            <select
              id="status"
              name="status"
              [(ngModel)]="formData.status"
              class="form-select"
              required>
              <option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Permissões TEA -->
      <div class="form-section">
        <h3 class="section-title">Permissões TEA</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Selecione as permissões:</label>
            <div class="permissoes-list permissoes-grid">
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_CLINICAS']" (change)="formData.permissoes && (formData.permissoes['TEA_CLINICAS'] = $event.target.checked)" name="TEA_CLINICAS">
                <span>TEA Clínicas</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_HOME']"
                (change)="formData.permissoes && (formData.permissoes['TEA_HOME'] = $event.target.checked)" name="TEA_HOME">
                <span>TEA Clínica</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_CADASTRO']" (change)="formData.permissoes && (formData.permissoes['TEA_CADASTRO'] = $event.target.checked)" name="TEA_CADASTRO">
                <span>TEA Cadastro</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_TERAPEUTA']" (change)="formData.permissoes && (formData.permissoes['TEA_TERAPEUTA'] = $event.target.checked)" name="TEA_TERAPEUTA">
                <span>TEA Terapeuta</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_CALENDARIO']" (change)="formData.permissoes && (formData.permissoes['TEA_CALENDARIO'] = $event.target.checked)" name="TEA_CALENDARIO">
                <span>TEA Calendário</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_AGENDAMENTO']" (change)="formData.permissoes && (formData.permissoes['TEA_AGENDAMENTO'] = $event.target.checked)" name="TEA_AGENDAMENTO">
                <span>TEA Agendamento</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" [checked]="formData.permissoes?.['TEA_MODULO']" (change)="formData.permissoes && (formData.permissoes['TEA_MODULO'] = $event.target.checked)" name="TEA_MODULO">
                <span>TEA Módulo</span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div class="modal-footer">
      <button type="button" class="modal-btn modal-btn-secondary" (click)="onClose()">
        <i class="icon-x"></i>
        Cancelar
      </button>
      <button
        type="button"
        class="modal-btn modal-btn-primary"
        (click)="onSubmit()"
        [disabled]="!isFormValid()">
        <i class="icon-save"></i>
        {{ submitButtonText }}
      </button>
    </div>
  </div>
</div>