<div class="tea-layout">
    <div *ngIf="toast" class="toast" [ngClass]="toast.type" (click)="closeToast()">
      <strong>{{ toast.title }}</strong><br>
      <span>{{ toast.message }}</span>
    </div>
  <div class="tea-sidebar" [class.collapsed]="collapsed" *ngIf="!isTerapeutaModuleActive()">
    <!-- Header -->
    <div class="sidebar-header">
      <div class="logo-section" *ngIf="!collapsed">
        <div class="logo-container">
          <div class="logo-placeholder" *ngIf="!logoUrl">
            <i class="icon-brain"></i>
          </div>
          <img *ngIf="logoUrl" [src]="logoUrl" alt="Logo da empresa" class="logo-image" />
        </div>
        <div class="brand">
          <h1>TEA</h1>
          <p>Caring</p>
        </div>
        <div class="quick-actions" *ngIf="!collapsed">
          <a class="quick-action-btn" [routerLink]="['/tea/convenios']" title="Convênios">
            <i class="icon-convenios"></i>
          </a>

        </div>
      </div>
      
      <div class="logo-collapsed" *ngIf="collapsed">
        <div class="logo-placeholder-small">
          <i class="icon-brain"></i>
        </div>
      </div>
      
      <button class="toggle-btn" (click)="toggleCollapsed()">
        <i [class]="collapsed ? 'icon-menu' : 'icon-chevron-left'"></i>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="navigation">
      <!-- TEA Menu Items -->
      <ng-container *ngFor="let item of teaMenuItems; let i = index">
        <div *ngIf="!item.submenu">
          <a (click)="navigateTo(item.url)"
             class="nav-item">
            <i [class]="'icon-' + item.icon"></i>
            <span *ngIf="!collapsed">{{item.title}}</span>
          </a>
        </div>
        <div *ngIf="item.submenu" class="nav-group">
          <!-- [class.active]="isSubmenuActive(item)" Removido para evitar marcação incorreta -->
          <button class="nav-item submenu-trigger" 
                  (click)="toggleSubmenu(i)">
            <div class="nav-item-content">
              <i [class]="'icon-' + item.icon"></i>
              <span *ngIf="!collapsed">{{item.title}}</span>
            </div>
            <i *ngIf="!collapsed" 
               class="icon-chevron-down submenu-icon" 
               [class.rotated]="openSubmenuIndex === i"></i>
          </button>
          
          <div *ngIf="!collapsed && openSubmenuIndex === i" class="submenu">
            <a *ngFor="let sub of item.submenu" 
               (click)="navigateTo(sub.url)"
               class="submenu-item">
              <i [class]="'icon-' + sub.icon"></i>
              <span>{{sub.title}}</span>
            </a>
          </div>
        </div>
      </ng-container>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer">
      <div *ngIf="!collapsed && profile" class="user-info">
        <p class="user-name">{{profile.nome}}</p>
        <p class="user-role">{{profile.perfil}}</p>
      </div>
      
      <button class="logout-btn" (click)="signOut()">
        <i class="icon-logout"></i>
        <span *ngIf="!collapsed">Sair</span>
      </button>
      
      <div *ngIf="!collapsed" class="version-info">
        <p class="system-name">Módulo TEA</p>
        <p class="version">v1.0.0</p>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="tea-main-content" [ngClass]="{ 'sidebar-collapsed': collapsed, 'no-tea-sidebar': isTerapeutaModuleActive() }">
    <router-outlet></router-outlet>
  </div>
</div>